---
title: "selenium with simon's code"
author: "Francesca"
date: "28/10/2021"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

## R Markdown

This is an R Markdown document. Markdown is a simple formatting syntax for authoring HTML, PDF, and MS Word documents. For more details on using R Markdown see <http://rmarkdown.rstudio.com>.

When you click the **Knit** button a document will be generated that includes both content as well as the output of any embedded R code chunks within the document. You can embed an R code chunk like this:

```{r cars}


## setup R + RSelenium -------------------------

# load RSelenium
library(tidyverse)
library(rvest)
library(RSelenium)

# initiate Selenium driver

remDr <- RSelenium::remoteDriver (remoteServerAddr = "localhost",
                     port = 4444L,
                     browserName = "firefox")
remDr$open()


# start browser, navigate to page
#go to kayak.com 

url <- "https://www.kayak.com/"
remDr$navigate(url)

# accepting cookies  with xpath
accept_all_xpath<- '//*[@id="onetrust-accept-btn-handler"]'

#accept all with another xpath (?)

accept_all_path2<-' //*[@id="vttr-accept"]'
acceptAllElem<-remDr$findElement(using='xpath', value=accept_all_xpath2)

#accept all with id
acceptAllElem3<- remDr$findElement(using="id", value="H6dt-accept")


acceptAllElem3$clickElement()

#deciding destination 

xpath_dest<- "/html/body/div[1]/div[1]/main/div[1]/div[1]/div/div[1]/div/div/section[2]/div/div/div/div/div/div[1]/div[2]/div/div[3]/div/div"

destElem<- remDr$findElement(using="xpath", value=xpath_dest)



destElem$clickElement()

#it worked until here!!








#this is to type specific destination

destination_xpath<-'/html/body/div[46]/div/div[2]/div[1]/div[2]/div/input'
destTypeElem <- remDr$findElement(using='xpath', value= destination_xpath)

destTypeElem <- remDr$findElement(using='class', value="k_my-input")

destTypeElem$clickElement()

destTypeElem$sendKeysToElement(list(key = "Tokyo"))


#click on can't decide

xpath_cant_decide<- '//*[@id="aCCQ"]/div[47]/div/div[2]/div[2]/div/ul/li/button/div[2]/span[2]'
cantDecideElem<-remDr$findElement(using='xpath',              value=xpath_cant_decide) 

cantDecideElem2<- remDr$findElement(using="class", value="hpCj hpCj-pres-item-horizon hpCj-clickable hpCj-anywhere")

cantDecideElem2$clickElement()








destiElem<-remDr$findElement("class", "k_my-input")
destiElem$clickElement()

destiElem$sendKeysToElement(list(key = "Tokyo"))






#going to kayak.com 


#xpath_kayak<- '//*[@id="Zen_]/div/div[1]/div[1]/div[1]/div/span/a'

kayakComElem<- remDr$findElement(using='class', value='UKS8-redirect-link')




kayakComElem$clickElement()
kayakComElem$highlightElement()



css<- '#Zen_ > div > div.fv-6-header > div.FbPt.FbPt-position-top.FbPt-relative > div.FbPt-content-col > div > span > a'
titleElem <- remDr$findElement(using = 'css', value = css)
titleElem$click()






titleElem$sendKeysToElement(list("data")) # enter key word

# select requested title data
xpath <- '//*[@id="main"]/div[8]/div[2]/select/option[7]' # plot
titledatElem1 <- remDr$findElement(using = 'xpath', value = xpath)
titledatElem1$clickElement() # click on list element

xpath <- '//*[@id="main"]/div[8]/div[2]/select/option[10]' # technical info
titledatElem2 <- remDr$findElement(using = 'xpath', value = xpath)
titledatElem2$clickElement() # click on list element

# scroll to end of page (just for fun)
webElem <- remDr$findElement("css", "body")
webElem$sendKeysToElement(list(key = "end"))

# click on search button
xpath <- '//*[@id="main"]/p[3]/button'
searchElem <- remDr$findElement(using = 'xpath', value = xpath)
searchElem$clickElement() # click on button

# store index page
output <- remDr$getPageSource(header = TRUE)
dir.create("data")
write(output[[1]], file = "data/imdb-data-movies.html")

# close connection
remDr$closeServer()

# parse html
content <- read_html("data/imdb-data-movies.html") 
titles <- html_nodes(content, xpath = '//*[contains(concat( " ", @class, " " ), concat( " ", "lister-item-header", " " ))]//a') %>% html_text
head(titles)




install.packages("RSelenium")











```

## Including Plots

You can also embed plots, for example:

```{r pressure, echo=FALSE}
plot(pressure)
```

Note that the `echo = FALSE` parameter was added to the code chunk to prevent printing of the R code that generated the plot.
